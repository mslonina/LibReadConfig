<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>LibReadConfig: sample-readconfig.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>sample-readconfig.c</h1><div class="fragment"><pre class="fragment">
<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include &lt;unistd.h&gt;</span>
<span class="preprocessor">#include &lt;stdarg.h&gt;</span>
<span class="preprocessor">#include &lt;sys/stat.h&gt;</span>
<span class="preprocessor">#include &lt;sys/types.h&gt;</span>
<span class="preprocessor">#include &lt;sys/wait.h&gt;</span>
<span class="preprocessor">#include &lt;signal.h&gt;</span>
<span class="preprocessor">#include &lt;fcntl.h&gt;</span>
<span class="preprocessor">#include &lt;sys/dir.h&gt;</span>
<span class="preprocessor">#include &lt;dirent.h&gt;</span>
<span class="preprocessor">#include &lt;ctype.h&gt;</span>
<span class="preprocessor">#include &lt;string.h&gt;</span>

<span class="preprocessor">#include &quot;<a class="code" href="libreadconfig_8h.html" title="LibreadConfig public library.">libreadconfig.h</a>&quot;</span>

<span class="preprocessor">#include &quot;hdf5.h&quot;</span>

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[]){

        <span class="keywordtype">char</span>* inif; 
  hid_t file;
  <span class="keywordtype">char</span>* sep = <span class="stringliteral">&quot;=&quot;</span>;
  <span class="keywordtype">char</span>* comm = <span class="stringliteral">&quot;#&quot;</span>;

        <span class="keywordtype">int</span> nprocs = 0;
  <span class="keywordtype">int</span> nbody = 0;
  <span class="keywordtype">int</span> dump = 0;
        <span class="keywordtype">float</span> period = 0.0;
  <span class="keywordtype">float</span> epoch = 0.0;
  <span class="keywordtype">int</span> xres = 0;
  <span class="keywordtype">int</span> yres = 0;
        
  <span class="keywordtype">int</span> k = 0;
        <span class="keywordtype">int</span> i = 0;
  <span class="keywordtype">int</span> opts = 0;
  <span class="keywordtype">int</span> h5opts = 0;

  <a name="_a0"></a><a class="code" href="struct_l_r_c__config_namespace.html" title="Namespace struct.">LRC_configNamespace</a> cs[50];
  <a class="code" href="struct_l_r_c__config_namespace.html" title="Namespace struct.">LRC_configNamespace</a> cc[50];

  <a name="_a1"></a><a class="code" href="struct_l_r_c__config_types.html" title="Allowed types.">LRC_configTypes</a> ct[9] = {
    {<span class="stringliteral">&quot;default&quot;</span>, <span class="stringliteral">&quot;inidata&quot;</span>, <a name="a2"></a><a class="code" href="libreadconfig_8h.html#ab23618efd91ff4daf0a4cefc69ae8236a626075ff289bf19d2daf8f45e2e9bc51">LRC_CHAR</a>},
    {<span class="stringliteral">&quot;default&quot;</span>, <span class="stringliteral">&quot;fs&quot;</span>, <a class="code" href="libreadconfig_8h.html#ab23618efd91ff4daf0a4cefc69ae8236a626075ff289bf19d2daf8f45e2e9bc51">LRC_CHAR</a>},
    {<span class="stringliteral">&quot;default&quot;</span>, <span class="stringliteral">&quot;nprocs&quot;</span>, <a name="a3"></a><a class="code" href="libreadconfig_8h.html#ab23618efd91ff4daf0a4cefc69ae8236a4eccac56b54b578b45fd49ebd00c271e">LRC_INT</a>},
    {<span class="stringliteral">&quot;default&quot;</span>, <span class="stringliteral">&quot;bodies&quot;</span>, <a class="code" href="libreadconfig_8h.html#ab23618efd91ff4daf0a4cefc69ae8236a4eccac56b54b578b45fd49ebd00c271e">LRC_INT</a>},
    {<span class="stringliteral">&quot;logs&quot;</span>, <span class="stringliteral">&quot;dump&quot;</span>, <a class="code" href="libreadconfig_8h.html#ab23618efd91ff4daf0a4cefc69ae8236a4eccac56b54b578b45fd49ebd00c271e">LRC_INT</a>},
    {<span class="stringliteral">&quot;logs&quot;</span>, <span class="stringliteral">&quot;period&quot;</span>, <a name="a4"></a><a class="code" href="libreadconfig_8h.html#ab23618efd91ff4daf0a4cefc69ae8236a58eef63677a4083b5228a8578f07de73">LRC_DOUBLE</a>},
    {<span class="stringliteral">&quot;logs&quot;</span>, <span class="stringliteral">&quot;epoch&quot;</span>, <a name="a5"></a><a class="code" href="libreadconfig_8h.html#ab23618efd91ff4daf0a4cefc69ae8236ad80b51ae3f79e72c7323fc80e0409891">LRC_FLOAT</a>},
    {<span class="stringliteral">&quot;farm&quot;</span>, <span class="stringliteral">&quot;xres&quot;</span>, <a class="code" href="libreadconfig_8h.html#ab23618efd91ff4daf0a4cefc69ae8236a4eccac56b54b578b45fd49ebd00c271e">LRC_INT</a>},
    {<span class="stringliteral">&quot;farm&quot;</span>, <span class="stringliteral">&quot;yres&quot;</span>, <a class="code" href="libreadconfig_8h.html#ab23618efd91ff4daf0a4cefc69ae8236a4eccac56b54b578b45fd49ebd00c271e">LRC_INT</a>}
  };
  <span class="keywordtype">int</span> numCT = 9;
        
  inif = <span class="stringliteral">&quot;sample-config&quot;</span>; <span class="comment">//input file</span>
        
  printf(<span class="stringliteral">&quot;\n&quot;</span>);
  
  <span class="comment">//Read config file. LRC will return number of namespaces.</span>
  opts = <a name="a6"></a><a class="code" href="group___l_r_c__wrappers.html#ga98adf1a77ae325830d4521b691ca33b0" title="Wrapper function.">LRC_parseConfigFile</a>(inif, sep, comm, cs, ct, numCT);
  
  <span class="comment">//You can handle any errors in the way You like.</span>
  <span class="keywordflow">if</span>(opts &lt; 0) exit(1);

  <span class="comment">//Here we just print all options using LRC_printAll()</span>
        printf(<span class="stringliteral">&quot;\nALL OPTIONS [%d]: \n&quot;</span>, opts);
  <a name="a7"></a><a class="code" href="group___l_r_c__wrappers.html#ga434aa10adcbb1572b06ed29b01187716" title="Prints all options.">LRC_printAll</a>(opts, cs);

  <span class="comment">//Now let us read config file stored in HDF5</span>

  <span class="comment">//We create HDF5 file</span>
  file = H5Fcreate(<span class="stringliteral">&quot;h5config.h5&quot;</span>, H5F_ACC_TRUNC, H5P_DEFAULT, H5P_DEFAULT);
  
  <span class="comment">// Copy config file to hdf5 file</span>
  <a name="a8"></a><a class="code" href="group___l_r_c__wrappers.html#ga142e285d5c8a3e6761d1a86668cfe9eb" title="Write config values to hdf file.">LRC_writeHdfConfig</a>(file, cs, opts);

  <span class="comment">// Read hdf5 config file</span>
  h5opts = <a name="a9"></a><a class="code" href="group___l_r_c__parser.html#ga3cbf6e172a98da00ec8fd0b301b4b8f9" title="Parse config data stored in HDF5 files.">LRC_hdfParser</a>(file, cc, ct, numCT);

  printf(<span class="stringliteral">&quot;H5OPTS = %d\n&quot;</span>, h5opts);
  
  <span class="comment">// Print all options</span>
  <a class="code" href="group___l_r_c__wrappers.html#ga434aa10adcbb1572b06ed29b01187716" title="Prints all options.">LRC_printAll</a>(h5opts, cc);
 
  <span class="comment">//Finally, we release resources.</span>
  H5Fclose(file);
        
        <span class="comment">// The tricky part is to do some conversions.</span>
        <span class="comment">// You need to handle this by hand, because we don&apos;t know</span>
  <span class="comment">// what variables You use. </span>
        printf(<span class="stringliteral">&quot;\nCONVERTED OPTIONS:\n&quot;</span>);
        <span class="keywordflow">for</span>(i = 0; i &lt; opts; i++){
    <span class="keywordflow">if</span>(strcmp(cs[i].space,<span class="stringliteral">&quot;default&quot;</span>) == 0 || strcmp(cs[i].space, <span class="stringliteral">&quot;logs&quot;</span>) == 0){
                  <span class="keywordflow">for</span>(k = 0; k &lt; cs[i].<a name="a10"></a><a class="code" href="struct_l_r_c__config_namespace.html#a86cf672daa4e0ad11ad10efc894d19c8">num</a>; k++){
                          <span class="keywordflow">if</span>(strcmp(cs[i].options[k].name,<span class="stringliteral">&quot;period&quot;</span>) == 0) period = atof(cs[i].options[k].value);  
                          <span class="keywordflow">if</span>(strcmp(cs[i].options[k].name,<span class="stringliteral">&quot;nprocs&quot;</span>) == 0) nprocs = atoi(cs[i].options[k].value); 
                          <span class="keywordflow">if</span>(strcmp(cs[i].options[k].name,<span class="stringliteral">&quot;bodies&quot;</span>) == 0) nbody = atoi(cs[i].options[k].value); 
                          <span class="keywordflow">if</span>(strcmp(cs[i].options[k].name,<span class="stringliteral">&quot;dump&quot;</span>) == 0) dump = atoi(cs[i].options[k].value); 
                          <span class="keywordflow">if</span>(strcmp(cs[i].options[k].name,<span class="stringliteral">&quot;epoch&quot;</span>) == 0) epoch = atof(cs[i].options[k].value); 
                  }
          }
    <span class="keywordflow">if</span>(strcmp(cs[i].space,<span class="stringliteral">&quot;map&quot;</span>) == 0){
                  <span class="keywordflow">for</span>(k = 0; k &lt; cs[i].<a class="code" href="struct_l_r_c__config_namespace.html#a86cf672daa4e0ad11ad10efc894d19c8">num</a>; k++){
                          <span class="keywordflow">if</span>(strcmp(cs[i].options[k].name,<span class="stringliteral">&quot;xres&quot;</span>) == 0) xres = atoi(cs[i].options[k].value);  
                          <span class="keywordflow">if</span>(strcmp(cs[i].options[k].name,<span class="stringliteral">&quot;yres&quot;</span>) == 0) yres = atoi(cs[i].options[k].value); 
      }
    }


         <span class="comment">// Here we just print options.</span>
    <span class="keywordflow">if</span>(strcmp(cs[i].space,<span class="stringliteral">&quot;default&quot;</span>) == 0 || strcmp(cs[i].space, <span class="stringliteral">&quot;logs&quot;</span>) == 0){
                printf(<span class="stringliteral">&quot;Namespace [%s]:\n&quot;</span>,cs[i].space);
                <span class="keywordflow">for</span>(k = 0; k &lt; cs[i].<a class="code" href="struct_l_r_c__config_namespace.html#a86cf672daa4e0ad11ad10efc894d19c8">num</a>; k++){
                        printf(<span class="stringliteral">&quot;%s\t = \t&quot;</span>,cs[i].options[k].name);
                        <span class="keywordflow">if</span> (strcmp(cs[i].options[k].name,<span class="stringliteral">&quot;period&quot;</span>) == 0) printf(<span class="stringliteral">&quot;%.6f\n&quot;</span>,period);
                        <span class="keywordflow">if</span> (strcmp(cs[i].options[k].name,<span class="stringliteral">&quot;inidata&quot;</span>) == 0) printf(<span class="stringliteral">&quot;%s\n&quot;</span>,cs[i].options[k].value);
                        <span class="keywordflow">if</span> (strcmp(cs[i].options[k].name,<span class="stringliteral">&quot;nprocs&quot;</span>) == 0) printf(<span class="stringliteral">&quot;%d\n&quot;</span>,nprocs);
                        <span class="keywordflow">if</span> (strcmp(cs[i].options[k].name,<span class="stringliteral">&quot;bodies&quot;</span>) == 0) printf(<span class="stringliteral">&quot;%d\n&quot;</span>,nbody);
                        <span class="keywordflow">if</span> (strcmp(cs[i].options[k].name,<span class="stringliteral">&quot;dump&quot;</span>) == 0) printf(<span class="stringliteral">&quot;%d\n&quot;</span>,dump);
                        <span class="keywordflow">if</span> (strcmp(cs[i].options[k].name,<span class="stringliteral">&quot;epoch&quot;</span>) == 0) printf(<span class="stringliteral">&quot;%.6f\n&quot;</span>,epoch);
                }
    
                printf(<span class="stringliteral">&quot;\n&quot;</span>);
    }
    <span class="keywordflow">if</span>(strcmp(cs[i].space,<span class="stringliteral">&quot;map&quot;</span>) == 0){
                printf(<span class="stringliteral">&quot;Namespace [%s]:\n&quot;</span>,cs[i].space);
                <span class="keywordflow">for</span>(k = 0; k &lt; cs[i].<a class="code" href="struct_l_r_c__config_namespace.html#a86cf672daa4e0ad11ad10efc894d19c8">num</a>; k++){
                        printf(<span class="stringliteral">&quot;%s\t = \t&quot;</span>,cs[i].options[k].name);
                        <span class="keywordflow">if</span> (strcmp(cs[i].options[k].name,<span class="stringliteral">&quot;xres&quot;</span>) == 0) printf(<span class="stringliteral">&quot;%d\n&quot;</span>,xres);
                        <span class="keywordflow">if</span> (strcmp(cs[i].options[k].name,<span class="stringliteral">&quot;yres&quot;</span>) == 0) printf(<span class="stringliteral">&quot;%d\n&quot;</span>,yres);
    }
    }

  }
        printf(<span class="stringliteral">&quot;\n&quot;</span>);

  <span class="keywordflow">return</span> 0;
}

</pre></div> </div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed Feb 3 20:34:04 2010 for LibReadConfig by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
